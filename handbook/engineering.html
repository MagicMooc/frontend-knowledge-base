<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端工程化 | 😎前端知识库@MagicMooc</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/icon.png">
    <meta name="description" content="好好学习，天天向上🥳">
    
    <link rel="preload" href="/assets/css/0.styles.7b8b3c13.css" as="style"><link rel="preload" href="/assets/js/app.ec3c4e52.js" as="script"><link rel="preload" href="/assets/js/3.a4c2a10e.js" as="script"><link rel="preload" href="/assets/js/1.f00e5e10.js" as="script"><link rel="preload" href="/assets/js/27.7719ab24.js" as="script"><link rel="prefetch" href="/assets/js/10.bb129b2a.js"><link rel="prefetch" href="/assets/js/11.1c4bf472.js"><link rel="prefetch" href="/assets/js/12.3c287ffb.js"><link rel="prefetch" href="/assets/js/13.bfcd80bb.js"><link rel="prefetch" href="/assets/js/14.720be740.js"><link rel="prefetch" href="/assets/js/15.5decac69.js"><link rel="prefetch" href="/assets/js/16.1f1e7299.js"><link rel="prefetch" href="/assets/js/17.d6cd6f0f.js"><link rel="prefetch" href="/assets/js/18.7e841435.js"><link rel="prefetch" href="/assets/js/19.b95bbb17.js"><link rel="prefetch" href="/assets/js/20.2072067c.js"><link rel="prefetch" href="/assets/js/21.358dfb7a.js"><link rel="prefetch" href="/assets/js/22.6310a9e3.js"><link rel="prefetch" href="/assets/js/23.c0e4fd1c.js"><link rel="prefetch" href="/assets/js/24.f5876fa3.js"><link rel="prefetch" href="/assets/js/25.09fb8c44.js"><link rel="prefetch" href="/assets/js/26.e0f5d0ea.js"><link rel="prefetch" href="/assets/js/28.17497b4f.js"><link rel="prefetch" href="/assets/js/29.de5f18ab.js"><link rel="prefetch" href="/assets/js/30.b9f57264.js"><link rel="prefetch" href="/assets/js/31.6e88de0c.js"><link rel="prefetch" href="/assets/js/32.65039cba.js"><link rel="prefetch" href="/assets/js/33.1f8582e6.js"><link rel="prefetch" href="/assets/js/34.231dff0c.js"><link rel="prefetch" href="/assets/js/35.8cfa85d6.js"><link rel="prefetch" href="/assets/js/36.e27e4fd8.js"><link rel="prefetch" href="/assets/js/37.01e2f16c.js"><link rel="prefetch" href="/assets/js/4.6fb38d24.js"><link rel="prefetch" href="/assets/js/5.5db26bf5.js"><link rel="prefetch" href="/assets/js/6.2bd1e2c1.js"><link rel="prefetch" href="/assets/js/7.685fbbae.js"><link rel="prefetch" href="/assets/js/8.126b558b.js"><link rel="prefetch" href="/assets/js/9.5b8e69c4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7b8b3c13.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>😎前端知识库@MagicMooc</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>好好学习，天天向上🥳</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">😎前端知识库@MagicMooc</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      more about me
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/MagicMooc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://magicmooc.top/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  My blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>19</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      more about me
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/MagicMooc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://magicmooc.top/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  My blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/about/welcome" class="sidebar-heading clickable"><span>Hey! This is MagicMooc</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/" aria-current="page" class="sidebar-link">欢迎来到我的前端知识库⭐️</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/handbook/overview" class="sidebar-heading clickable open"><span>前端知识库💻</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/handbook/baseLayout.html" class="sidebar-link">🌴前端基础-layout</a></li><li><a href="/handbook/baseJavascript.html" class="sidebar-link">🍀前端基础-javascript-基础</a></li><li><a href="/handbook/javascriptWeb.html" class="sidebar-link">🌵前端基础-javascript-web</a></li><li><a href="/handbook/network.html" class="sidebar-link">🌲计算机网络</a></li><li><a href="/handbook/browser.html" class="sidebar-link">🪴浏览器</a></li><li><a href="/handbook/engineering.html" aria-current="page" class="active sidebar-link">🪵前端工程化</a></li><li><a href="/handbook/react.html" class="sidebar-link">🌿React</a></li><li><a href="/handbook/wheel.html" class="sidebar-link">🍃手写代码问题（造轮子）</a></li><li><a href="/handbook/optimization.html" class="sidebar-link">🌳性能优化问题</a></li><li><a href="/handbook/interviewExperience.html" class="sidebar-link">🍁面试经验汇总</a></li><li><a href="/handbook/workExperience.html" class="sidebar-link">🌵工作经验汇总</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/algorithm/overview" class="sidebar-heading clickable"><span>必会的算法题,干!!!🔥</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/algorithm/programmercarl/overview" class="sidebar-heading clickable open"><span>🍏代码随想录</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/algorithm/programmercarl/Array.html" class="sidebar-link">🍦数组</a></li><li><a href="/algorithm/programmercarl/LinkedList.html" class="sidebar-link">🍩链表</a></li><li><a href="/algorithm/programmercarl/StackAndQueue.html" class="sidebar-link">🥛栈和队列</a></li><li><a href="/algorithm/programmercarl/Tree.html" class="sidebar-link">🍰二叉树</a></li><li><a href="/algorithm/programmercarl/Backtracking.html" class="sidebar-link">🍥回溯算法</a></li><li><a href="/algorithm/programmercarl/Greedy.html" class="sidebar-link">🍪贪心算法</a></li><li><a href="/algorithm/programmercarl/DP.html" class="sidebar-link">🍣动态规划</a></li><li><a href="/algorithm/programmercarl/mStack.html" class="sidebar-link">🫕单调栈</a></li></ul></section></li><li><a href="/algorithm/LeetcodeHot100.html" class="sidebar-link">🍊Leetcode热题100</a></li><li><a href="/algorithm/SwordToOffer.html" class="sidebar-link">🍋剑指Offer</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/interview/overview" class="sidebar-heading clickable"><span>八股文,爆!!!🚀</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/everyday.html" class="sidebar-link">🍏每日一题</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">前端工程化</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="前端工程化"><a href="#前端工程化" class="header-anchor">#</a> 前端工程化</h1> <h2 id="开篇"><a href="#开篇" class="header-anchor">#</a> 开篇</h2> <h3 id="背景-前端工程化的兴起"><a href="#背景-前端工程化的兴起" class="header-anchor">#</a> 背景：前端工程化的兴起</h3> <p>曾经的<code>JS</code>只是作为丰富页面效果的脚本语言，通过植入预设逻辑就能让页面生动起来，提升用户体验。<code>JS</code>自1995年诞生以来，我觉得有六种前端技术让前端在短时间内产生了从量变到质变的跳跃。</p> <ul><li><strong>AJAX</strong>：诞生于<code>2005年</code>，无需刷新即可快速动态更新局部页面的Web开发技术</li> <li><strong>Jquery</strong>：诞生于<code>2006年</code>，提供简便<code>JS设计模式</code>且优化<code>DOM操作</code>、<code>语言增强</code>、<code>事件处理</code>、<code>动画设计</code>、<code>AJAX交互</code>等功能的<code>JS框架</code></li> <li><strong>Angular</strong>：诞生于<code>2009年</code>，提供<code>MVC</code>、<code>模块化</code>、<code>双向绑定</code>、<code>依赖注入</code>、<code>语义标签</code>等功能的<code>JS框架</code></li> <li><strong>Node</strong>：诞生于<code>2009年</code>，基于<code>Chrome V8引擎</code>使用<code>事件驱动</code>与<code>非阻塞式I/O模型</code>让<code>JS</code>运行在服务端的<code>JS运行环境</code></li> <li><strong>React</strong>：诞生于<code>2013年</code>，采用声明范式轻松描述应用，通过<code>虚拟DOM</code>最大限度减少与<code>DOM</code>交互的<code>JS框架</code></li> <li><strong>Serverless</strong>：诞生于<code>2015年</code>，无需服务器管理应用程序的构建与运行的概念</li></ul> <p>基于上述六种前端技术，我将前端发展历程划分为以下阶段。每种前端技术都为当前阶段提供了推进作用，将前端从一个层次推升到另一个层次。每种前端技术在出现时都可能不受重视，随着时间推移与项目实践，它可能从众多技术中突围而出。这些热门的前端技术都能形成一个庞大且热闹的生态社区，各路开发者都踊跃贡献自身一份力量，这些前端技术慢慢地就会沉淀出一条主流的技术栈或工具链，以推动<code>前端工程化</code>的发展。</p> <h4 id="模块化"><a href="#模块化" class="header-anchor">#</a> 模块化</h4> <p><strong>模块化</strong>指将一个复杂应用根据预设规范封装为多个块并组合起来，对内实现数据私有化，对外暴露接口与其它模块通信。</p> <p><code>模块化</code>是<code>前端工程化</code>的重中之重。它在<code>前端工程化</code>中具体表现为：在文件层面上对代码与资源实现拆分与组装，将一个大文件拆分为互相依赖的小文件，再统一拼装与加载。</p> <p>对于一个完善的<code>Web项目</code>，一般是<code>SPA/MPA</code>，推荐使用以下目录结构将整个项目划分为各种通用模块。为了让目录结构更突出其功能，就不包括那些杂七杂八的工具链配置文件了。</p> <div class="language- extra-class"><pre class="language-text"><code>project
├─ dist          # 输出目录
│  ├─ prod         # 生产环境执行代码
│  └─ test         # 测试环境执行代码
├─ src           # 源码目录
│  ├─ apis         # 接口模块：包括全局接口请求的功能，控制数据定向转换
│  ├─ assets       # 资源模块：包括样式、脚本、字体、图像、音频、视频等资源文件
│  ├─ components   # 组件模块：包括全局通用的基础组件、皮肤主题和字体图标
│  ├─ layouts      # 布局模块：包括以布局为最小粒度的组件集合，由至少一个基础组件组成
│  ├─ flows        # 流程模块：包括以流程为最小粒度的组件集合，由至少一个基础组件组成
│  ├─ pages        # 页面模块：包括以页面为最小粒度的组件集合，由至少一个基础组件组成
│  ├─ routes       # 路由模块：包括全局页面跳转的功能，控制页面自由切换
│  ├─ stores       # 数据模块：包括全局数据状态的功能，控制数据驱动视图
│  ├─ views        # 视图模块：包括以视图为最小粒度的组件集合，由至少一个基础组件组成
│  ├─ utils        # 工具模块：包括全局通用的常量与方法
│  ├─ index.html   # 模板入口文件
│  ├─ index.js     # 脚本入口文件
│  └─ index.scss   # 样式入口文件
└─ package.json
</code></pre></div><p>对于一个完善的<code>Node项目</code>，一般是<code>接口系统</code>，推荐使用以下目录结构将整个项目划分为各种通用模块。为了让目录结构更突出其功能，就不包括那些杂七杂八的工具链配置文件了。</p> <div class="language- extra-class"><pre class="language-text"><code>project
├─ dist          # 输出目录
│  ├─ prod         # 生产环境执行代码
│  └─ test         # 测试环境执行代码
├─ src           # 源码目录
│  ├─ assets       # 资源模块：包括样式、脚本、字体、图像、音频、视频等资源文件
│  ├─ models       # 模型模块：包括全局数据模型的功能
│  ├─ routes       # 路由模块：包括全局接口请求的功能
│  ├─ utils        # 工具模块：包括全局通用的常量与方法
│  └─ index.js     # 脚本入口文件
└─ package.json
</code></pre></div><h4 id="组件化"><a href="#组件化" class="header-anchor">#</a> 组件化</h4> <p><strong>组件化</strong>指将一个具备通用功能的交互设计划分为模板、样式和逻辑组成的功能单元，对内管理内部状态满足交互需求，对外提供属性接口扩展用户需求。</p> <p><code>组件化</code>是<code>前端工程化</code>的重要基础。它实现了代码更高层次的复用性，提升开发效率。组件的封装也是对象的封装，同样要做到<strong>高内聚低耦合</strong>，<code>组件化</code>的项目不仅利于<code>单元测试</code>的进行，同样也利于需求迭代的推进。</p> <p>优秀的<code>组件化</code>遵循以下设计哲学。</p> <ul><li>将设计图划分为最小组件层级</li> <li>使用预设规范创建组件静态版本</li> <li>确定组件内部最小且完整的状态的表示方式</li> <li>确定组件内部最小且完整的状态的存放方式</li> <li>实现数据流的正向传递与反向传递</li></ul> <p><strong>模块化着重在文件层面上对代码与资源实现拆分与组装，组件化着重在功能层面上对交互与设计实现拆分与组装</strong>。</p> <h4 id="规范化"><a href="#规范化" class="header-anchor">#</a> 规范化</h4> <p><strong>规范化</strong>指将一系列预设规范接入工程各个阶段，通过各项指标标准化开发者的工作流程，引导开发者在团队协作中往更好的方向发展。</p> <p><code>规范化</code>是<code>前端工程化</code>的重要部分。它有效地将一盘松散的规范通过指定标准凝聚在一起，将所有工作流程标准化，协同所有开发者以标准化的方式定义工作流程，同时也影响着代码、文档和日志，甚至影响着每个开发者及其团队发展方向，因此每个成熟的前端团队都有一套身经百战的<code>规范化方案</code>。</p> <p><code>规范化</code>更多应用在团队协作中，为每个开发者指明一个方向，引领着成员往该方向走。若团队无<code>规范化</code>，每个开发者各做各的事情，在合并代码时肯定会发生争吵，甚至影响工作效率。</p> <h4 id="自动化"><a href="#自动化" class="header-anchor">#</a> 自动化</h4> <p><strong>自动化</strong>指将一系列繁琐重复的工作流程交由程序根据预设脚本自动处理，整个工作流程无需人工参与，以解放开发者双手让其更专注业务需求的开发。</p> <p><code>自动化</code>是<code>前端工程化</code>的智能部分。它既可解放双手又能节省大量时间做更多有意义的事情，常见<code>自动化</code>场景包括但不限于<code>自动化构建</code>、<code>自动化测试</code>、<code>自动化打包</code>、<code>自动化发布</code>和<code>自动化部署</code>，更高级的自动化场景包括但不限于<code>持续集成</code>、<code>持续交付</code>和<code>持续部署</code>。以<code>自动化构建</code>为例，又可将其划分为以下子任务，这些子任务分布在<code>自动化构建</code>不同阶段，在不同阶段的最佳时刻会调用相关工具处理相关流程。</p> <table><thead><tr><th><strong>任务</strong></th> <th><strong>职责</strong></th></tr></thead> <tbody><tr><td><strong>Stylelint</strong></td> <td>校验样式代码</td></tr> <tr><td><strong>Eslint</strong></td> <td>校验脚本代码</td></tr> <tr><td><strong>Postcss</strong></td> <td>Postcss → CSS</td></tr> <tr><td><strong>Sass</strong></td> <td>SASS → CSS</td></tr> <tr><td><strong>Less</strong></td> <td>LESS → CSS</td></tr> <tr><td><strong>Babel</strong></td> <td>ES6 → ES5</td></tr> <tr><td><strong>TypeScript</strong></td> <td>TS → JS</td></tr></tbody></table> <p><code>自动化</code>整体重心偏向于构建，构建为工程服务，工程又为用户服务，因此一个项目会演化出至少两种运行环境，分别是开发环境与生产环境。其中开发环境工程为开发者服务，生产环境工程为用户服务。</p> <p>学习<code>前端工程化</code>能让一个开发者在任何时刻面对任何情况都能使用工程化的思想解决问题。掌握<code>前端工程化</code>可通过以下方面思考，相信<code>前端工程化</code>对工作能力与岗位竞争都会有很大帮助。</p> <ul><li><strong>前后分离</strong>：前端应自成体系且与后端分离，包括但不限于规范、服务、环境、构建、组织和部署方面</li> <li><strong>技术选型</strong>：不能以一个框架满足所有业务场景，需制定多套框架解决方案避免技术瓶颈的出现</li> <li><strong>重构封装</strong>：新生技术不断涌现就要避免改头换面式的重构，重复需求不断出现就要学会举一反三的封装</li> <li><strong>工程设计</strong>：解决方案要合理分层且互相独立，随时应对各种变化，任何一层可低成本被替换与淘汰</li></ul> <h3 id="模块规范"><a href="#模块规范" class="header-anchor">#</a> 模块规范</h3> <h4 id="模块化-2"><a href="#模块化-2" class="header-anchor">#</a> 模块化</h4> <p><code>JS</code>诞生于<code>1995年</code>，最初设计的目的是实现一些简单的浏览器交互效果，寥寥数语就能为用户提供良好的操作体验。随着<code>JS</code>的快速发展，各种前端技术得到广泛应用，特别是<code>AJAX</code>与<code>Jquery</code>引发的前端大革命让<code>JS</code>得到质的提升，但各种问题也接踵而至。</p> <p>在实际开发过程中，经常会遇到<code>变量名称</code>或<code>函数名称</code>一样的情况。这不仅容易造成<strong>命名冲突</strong>，还会污染全局变量。若在应用特别复杂，存在大量相似代码，又引用很多第三方库的情况下，稍不注意就很易造成文件的<strong>依赖混乱</strong>。</p> <p>基于此，<code>JS</code>也引入<code>模块化</code>的概念。<strong>早期的模块化不是真正的模块化，只是通过一些“骚操作”实现看似是模块化的效果</strong>，例如<code>立即调用函数表达式</code>(简称<code>IIFE</code>)就是一个在定义时可立即执行的函数，至于它如何实现<code>模块化</code>，可查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FGlossary%2FIIFE" target="_blank" rel="noopener noreferrer">MDN文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，在此不深入讲述了。<strong>后期的模块化才算是真正的模块化</strong>，它包括<code>CJS</code>、<code>AMD</code>、<code>CMD</code>、<code>UMD</code>和<code>ESM</code>，经过多年演变，目前<code>Web开发</code>倾向于<code>ESM</code>，<code>Node开发</code>倾向于<code>CJS</code>。</p> <p><code>模块化</code>让<code>JS</code>也能拥有自己的<code>模块化效果</code>，在实际开发中，<strong>一个模块就是一个文件</strong>。<code>模块化</code>的核心包括以下特性，基本都是围绕如何处理文件(<code>模块</code>)。</p> <ul><li><strong>拆分</strong>：将代码根据功能拆分为多个可复用模块</li> <li><strong>加载</strong>：通过指定方式加载模块并执行与输出模块</li> <li><strong>注入</strong>：将一个模块的输出注入到另一个模块</li> <li><strong>管理</strong>：因为工程模块数量众多需管理模块间的依赖关系</li></ul> <p>前端代码爆炸式增长必然会引入<code>前端工程化</code>解决问题，<code>模块化</code>作为<code>前端工程化</code>中最低成本的应用，很值得每一位开发者遵守。使用<code>模块化</code>开发代码，不仅能提高代码整体可读性，也能增强项目整体维护性。不管是个人开发还是协作开发，<code>模块化</code>都能带来很多好处。</p> <img src="https://picmagic.oss-cn-beijing.aliyuncs.com/img/image-20220614152659121.png" alt="image-20220614152659121" style="zoom:67%;"> <h4 id="模块方案"><a href="#模块方案" class="header-anchor">#</a> 模块方案</h4> <p>以前引用<code>js文件</code>都会使用多个<code>&lt;script&gt;</code>顺序处理，曾见过一个老旧项目多达<code>12</code>个<code>&lt;script&gt;</code>，这会导致很多问题，例如以下情况。</p> <ul><li><strong>请求过多</strong>：每个<code>&lt;script&gt;</code>都有一个<code>src</code>必然会增加<code>HTTP</code>请求次数</li> <li><strong>依赖模糊</strong>：每个<code>&lt;script&gt;</code>的摆放顺序都有可能影响前后脚本加载错误</li> <li><strong>难以维护</strong>：每个<code>&lt;script&gt;</code>的变量命名与函数作用域都有可能互相影响</li></ul> <p><code>JS模块化</code>就很好地解决了上述问题，具体有哪些解决方案？在<code>JS</code>发展历程中，主要有六种常见模块方案，分别是<strong>IIFE</strong>、<strong>CJS</strong>、<strong>AMD</strong>、<strong>CMD</strong>、<strong>UMD</strong>和<strong>ESM</strong>。为了方便对比，通过下图展示它们各自的定义与特性，相信你有更好的理解。</p> <p><img src="https://picmagic.oss-cn-beijing.aliyuncs.com/img/image-20220614153248389.png" alt="image-20220614153248389"></p> <p>分析每个模块方案的特性可知，<code>同步加载</code>包括<code>IIFE</code>与<code>CJS</code>，<code>异步加载</code>包括<code>AMD</code>、<code>CMD</code>和<code>ESM</code>。浏览器可兼容<code>IIFE</code>与<code>AMD</code>，服务器可兼容<code>CJS</code>，浏览器与服务器都兼容<code>CMD</code>、<code>UMD</code>和<code>ESM</code>。</p> <p>目前只需关注<code>CJS</code>与<code>ESM</code>，那它们到底有何细微不同？</p> <img src="/Users/zhanghao/Pictures/img/image-20220614153806064.png" alt="image-20220614153806064" style="zoom:80%;"> <p><code>Node开发</code>习惯使用<code>CJS</code>编码，但本章将改用<code>ESM</code>编码，因此在后续编码过程中可能会出现一些难以解释的问题，例如<code>循环引用</code>与<code>前置引用</code>，而了解它们的加载方式与行为可帮助你理解这些问题。</p> <ul><li><strong>运行时加载</strong>指整体加载模块生成一个对象，再从对象中获取所需的属性方法去加载。最大特性是<code>全部加载</code>，只有运行时才能得到该对象，无法在编译时做静态优化。</li> <li><strong>编译时加载</strong>指直接从模块中获取所需的属性方法去加载。最大特性是<code>按需加载</code>，在编译时就完成模块加载，效率比其他方案高，无法引用模块本身(<code>本身不是对象</code>)，但可拓展<code>JS</code>高级语法(<code>宏与类型校验</code>)。</li></ul> <p>上述介绍了好几种模块方案，那<code>前端工程化</code>都会用到吗？当然不会，可能只需使用<code>CJS</code>或<code>ESM</code>，而目前只需使用<code>ESM</code>编码，因此接着重点关注<code>ESM</code>。</p> <h4 id="现状-esm能否在node环境中运行"><a href="#现状-esm能否在node环境中运行" class="header-anchor">#</a> 现状：ESM能否在Node环境中运行</h4> <p>随着主流浏览器逐步支持<code>ESM</code>，越来越多目光投注于<code>Node</code>对于<code>ESM</code>的支持上。目前<code>Node</code>使用<code>CJS</code>作为官方模块方案，虽然内置模块方案促进<code>Node</code>的流行，但也阻碍了<code>ESM</code>的引入，这一点相信接触过<code>Node开发</code>的同学一定深有感触。</p> <h4 id="原生支持esm"><a href="#原生支持esm" class="header-anchor">#</a> 原生支持ESM</h4> <p><code>2017年10月31日</code>，<code>Node</code>发布了<code>v8.9.0</code>，从此只要在命令中加上<code>--experimental-modules</code>，<code>Node</code>就可象征性地支持<code>ESM</code>了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">node</span> --experimental-modules index.js
</code></pre></div><p>但<code>低版本 Node</code>依然无法直接支持<code>ESM</code>解析，还需在运行环境中<code>“做些手脚”</code>才行。</p> <p>接着<code>Node</code>发布了<code>v13.2.0</code>带来一些新特性，正式取消<code>--experimental-modules</code>启动参数。当然并不是删除<code>--experimental-modules</code>，而是在其原有基础上实现对<code>ESM</code>的实验性支持并默认启动。</p> <p><code>--experimental-modules</code>特性包括以下方面。</p> <ul><li><p>使用<code>type</code>指定模块方案</p> <ul><li>在<code>package.json</code>中指定<code>type</code>为<code>commonjs</code>，则使用<code>CJS</code></li> <li>在<code>package.json</code>中指定<code>type</code>为<code>module</code>，则使用<code>ESM</code></li></ul></li> <li><p>使用<code>--input-type</code>指定入口文件的模块方案，与<code>type</code>一样</p> <ul><li>命令中加上<code>--input-type=commonjs</code>，则使用<code>CJS</code></li> <li>命令中加上<code>--input-type=module</code>，则使用<code>ESM</code></li></ul></li> <li><p>支持新文件后缀<code>.cjs</code></p> <ul><li>文件后缀使用<code>.cjs</code>，则使用<code>CJS</code></li></ul></li> <li><p>使用<code>--es-module-specifier-resolution</code>指定文件名称引用方式</p> <ul><li>命令中加上<code>--es-module-specifier-resolution=explicit</code>，则引用模块时必须使用文件后缀(<code>默认</code>)</li> <li>命令中加上<code>--es-module-specifier-resolution=node</code>，则引用模块时无需使用文件后缀</li></ul></li> <li><p>使用<code>main</code>根据<code>type</code>指定模块方案加载文件</p> <ul><li>在<code>package.json</code>中指定<code>main</code>后会根据<code>type</code>指定模块方案加载文件</li></ul></li></ul> <h4 id="cjs-esm判断方式"><a href="#cjs-esm判断方式" class="header-anchor">#</a> CJS/ESM判断方式</h4> <p><code>Node</code>要求使用<code>ESM</code>的文件采用<code>.mjs</code>后缀，只要文件中存在<code>import/export命令</code>就必须使用<code>.mjs</code>后缀。若不希望修改文件后缀，可在<code>package.json</code>中指定<code>type</code>为<code>module</code>。基于此，若其他文件使用<code>CJS</code>，就需将其文件后缀改为<code>.cjs</code>。若在<code>package.json</code>中未指定<code>type</code>或指定<code>type</code>为<code>commonjs</code>，则以<code>.js</code>为后缀的文件会被解析为<code>CJS</code>。</p> <p>简而言之，<code>mjs文件</code>使用<code>ESM</code>解析，<code>cjs文件</code>使用<code>CJS</code>解析，<code>js文件</code>使用基于<code>package.json</code>指定的<code>type</code>解析(<code>type=commonjs</code>使用<code>CJS</code>，<code>type=module</code>使用<code>ESM</code>)。</p> <p>当然还可通过命令参数处理，不过我认为这样做操作过多，所以就不讨论具体方法了。</p> <p>刚才说了<code>Node v13.2.0</code>在默认情况下，会启动对<code>ESM</code>的实验支持，无需在命令中加上<code>--experimental-modules</code>参数。那<code>Node</code>是如何区分<code>CJS</code>与<code>ESM</code>？简而言之，<code>Node</code>会将以下情况视为<code>ESM</code>。</p> <ul><li>文件后缀为<code>.mjs</code></li> <li>文件后缀为<code>.js</code>且在<code>package.json</code>中指定<code>type</code>为<code>module</code></li> <li>命令中加上<code>--input-type=module</code></li> <li>命令中加上<code>--eval cmd</code></li></ul> <h3 id="方案-部署node的esm开发环境"><a href="#方案-部署node的esm开发环境" class="header-anchor">#</a> 方案：部署Node的ESM开发环境</h3> <p>在部署<code>Node</code>的<code>ESM开发环境</code>前需初始一个示例，以下所有代码都基于该项目进行。</p> <p>在根目录中创建<code>package.json</code>并执行<code>npm i</code>安装项目依赖。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-esm&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/index.js&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node src/index.js&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;@yangzw/bruce-us&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.3&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建<code>src/index.js</code>文件，加入以下内容。示例引用我开源的<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Ftree%2Fmain%2Fpackages%2Fus" target="_blank" rel="noopener noreferrer">@yangzw/bruce-us<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，其中<code>NodeType()</code>用于获取<code>Node</code>相关信息。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NodeType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@yangzw/bruce-us/dist/node&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">NodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这一步完成就需分情况讨论了。</p> <h4 id="node原生部署方案"><a href="#node原生部署方案" class="header-anchor">#</a> Node原生部署方案</h4> <p>假设<code>Node</code>是<code>v13.2.0</code>以上版本，执行<code>npm start</code>，输出以下信息表示运行失败。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>node:56155<span class="token punctuation">)</span> Warning: To load an ES module, <span class="token builtin class-name">set</span> <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;module&quot;</span> <span class="token keyword">in</span> the package.json or use the .mjs extension.
<span class="token punctuation">(</span>Use <span class="token variable"><span class="token variable">`</span><span class="token function">node</span> --trace-warnings <span class="token punctuation">..</span>.<span class="token variable">`</span></span> to show where the warning was created<span class="token punctuation">)</span>
/Users/<span class="token punctuation">..</span>./node-esm/for-node/src/index.js:1
<span class="token function">import</span> <span class="token punctuation">{</span> NodeType <span class="token punctuation">}</span> from <span class="token string">&quot;@yangzw/bruce-us/dist/node&quot;</span><span class="token punctuation">;</span>
^^^^^^

SyntaxError: Cannot use <span class="token function">import</span> statement outside a module
</code></pre></div><p>这是因为<code>Node</code>根据刚才提到的四种情况也无法识别出是<code>ESM</code>，知道原因很快就能找出解决方案了。在保持所有文件后缀为<code>.js</code>的前提下，在<code>package.json</code>中指定<code>type</code>为<code>module</code>。</p> <p>为何一定要保持所有文件后缀为<code>.js</code>？作为<code>前端开发者</code>且使用<code>JS</code>编码，那保证文件后缀为<code>.js</code>再正常不过，不想出幺蛾子就不要乱改文件后缀。</p> <p>为了让<code>Node</code>支持<code>ESM</code>，还需为其指定<code>Node/Npm</code>版本限制。这是为了避免预设与实际情况不同而报错，例如预设该项目在高版本运行，实际却在低版本运行。</p> <p><code>Node</code>与<code>Npm</code>是成双成对地安装，可通过<a href="https://link.juejin.cn/?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload%2Freleases" target="_blank" rel="noopener noreferrer">Node Releases<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>查询到<code>Node v13.2.0</code>对应<code>Npm v6.13.1</code>。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;engines&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt;=13.2.0&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;npm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt;=6.13.1&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重新执行<code>npm start</code>，输出以下信息表示运行失败。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>internal/process/esm_loader.js:74
internalBinding<span class="token punctuation">(</span><span class="token string">&quot;errors&quot;</span><span class="token punctuation">)</span>.triggerUncaughtException<span class="token punctuation">(</span>

Error <span class="token punctuation">[</span>ERR_MODULE_NOT_FOUND<span class="token punctuation">]</span>: Cannot <span class="token function">find</span> module <span class="token punctuation">..</span>.
Did you mean to <span class="token function">import</span> @yangzw/bruce-us/dist/node.js?
</code></pre></div><p>根据报错提示，可知模块路径不存在，这主要是因为<strong>显式文件名称</strong>使用不对。</p> <p>首先<code>高版本Node</code>在默认情况下，对<code>import命令</code>的文件后缀存在强制性，因此<code>import &quot;./file&quot;</code>并不等于<code>import ./file.js</code>。其次<code>CJS</code>的自动后缀处理行为可通过<code>--es-module-specifier-resolution=node</code>开启，但模块主入口并不会受到<code>ESM</code>的影响，例如<code>import Path from &quot;path&quot;</code>照样可正常运行。在命令中加上<code>--es-module-specifier-resolution=node</code>就能解决显示文件名称的问题。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --es-module-specifier-resolution=node src/index.js&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为何这样设计显式文件名称？这主要是想通过<code>Node</code>提供的通用解决方案鼓励开发者编写<code>Web</code>与<code>Node</code>共享的代码。</p> <p>重新修改文件名称后再执行<code>npm start</code>，输出以下信息运行成功，这次就无任何问题了！</p> <p><code>Node</code>使用<code>ESM</code>除了上述问题外，还存在一些特别差异。特别是<code>ESM</code>不再提供<code>Node</code>某些特性与不能灵活引用<code>json文件</code>了，因此<code>__dirname</code>、<code>__filename</code>、<code>require</code>、<code>module</code>和<code>exports</code>这几个特性将无法使用。</p> <p>不过，上帝关闭一扇门的同时还会打开另一扇窗，可采用以下方式解决这些问题。</p> <ul><li><code>__filename</code>与<code>__dirname</code>可用<code>import.meta</code>对象重建</li> <li><code>require</code>、<code>module</code>和<code>exports</code>可用<code>import</code>与<code>export</code>代替</li> <li><code>json文件</code>的引用可用<code>Fs模块</code>的<code>readFileSync</code>与<code>JSON.parse()</code>代替</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> readFileSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> dirname <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;url&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> __filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> __dirname <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__filename<span class="token punctuation">,</span> __dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;./info.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>CJS</code>的循环依赖关系已通过缓存各个模块的<code>module.exports</code>对象解决，但<code>ESM</code>用了所谓的绑定。简而言之，<code>ESM</code>模块不会导出导入值而是引用值。</p> <ul><li><strong>导入引用模块可访问该引用但无法修改它</strong>。</li> <li><strong>导出引用模块可为引用该模块的模块重新分配值且该值由导入引用模块使用</strong></li></ul> <p>而<code>CJS</code>允许在任何时间点将引用分配给模块的<code>module.exports</code>对象，让这些改动仅部分反映在其他模块。</p> <h4 id="node编译部署方案"><a href="#node编译部署方案" class="header-anchor">#</a> Node编译部署方案</h4> <p><code>Npm</code>大部分模块都使用<code>CJS</code>编码，因为同时使用<code>require</code>与<code>export/import</code>会报错，所以单个模块无法切换到<code>ESM</code>。</p> <p>可用<code>babel</code>将代码从<code>ESM</code>转换为<code>CJS</code>，因此使用<code>babel</code>编译<code>ESM</code>代码是低版本<code>Node</code>支持<code>ESM</code>最稳定的方案无之一。在<code>Node v8.9.0</code>前的版本无法使用<code>--experimental-modules</code>支持<code>ESM</code>，也就更需<code>babel</code>解决该问题了。</p> <p>当然在任何版本中，<code>babel</code>都能让新语法转换为与旧环境兼容的代码，因此在<code>高版本Node</code>中也同样适用。</p> <p>接着在<code>v13.2.0</code>以下版本中部署。执行以下命令安装<code>babel</code>相关工具链到<code>devDependencies</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i @babel/cli @babel/core @babel/node @babel/preset-env -D
</code></pre></div><p>这四个<code>babel</code>子包很重要，<code>Node</code>能不能支持<code>ESM</code>的解析就看它们了。</p> <ul><li><strong>@babel/cli</strong>：提供支持<code>@babel/core</code>的命令运行环境</li> <li><strong>@babel/core</strong>：提供转译函数</li> <li><strong>@babel/node</strong>：提供支持<code>ESM</code>的命令运行环境</li> <li><strong>@babel/preset-env</strong>：提供预设语法转换集成环境</li></ul> <p>安装完毕，在<code>package.json</code>中指定<code>babel</code>相关配置，将<code>start</code>命令中的<code>node</code>替换为<code>babel-node</code>。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel-node src/index.js&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;babel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;@babel/preset-env&quot;</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行<code>npm start</code>，输出以下信息表示运行成功，到此整体坑位几乎为零。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">{</span>
	nodeVs: <span class="token string">&quot;12.22.10&quot;</span>,
	npmVs: <span class="token string">&quot;6.14.16&quot;</span>,
	system: <span class="token string">&quot;macos&quot;</span>,
	systemVs: <span class="token string">&quot;19.6.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然该方案无需在<code>package.json</code>中指定<code>engines</code>，毕竟其目的还是将代码的模块方案从<code>ESM</code>转换为<code>CJS</code>。若需兼容<code>更低版本Node</code>，可在<code>package.json</code>中指定<code>babel</code>的<code>targets</code>。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;babel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.0.0&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="监听脚本自动重启命令"><a href="#监听脚本自动重启命令" class="header-anchor">#</a> 监听脚本自动重启命令</h4> <p>每次修改脚本都需重启命令才能让脚本内容生效，这太麻烦了，所以我始终喜欢在<code>Node</code>中使用<code>nodemon</code>。<strong>nodemon</strong>是一个自动检测项目文件发生变化就重启服务的<code>Npm模块</code>，是<code>Node开发</code>的必备工具。</p> <p>以<strong>Node编译部署方案</strong>的示例为例。执行<code>npm i -D nodemon</code>安装<code>nodemon</code>，在<code>package.json</code>中指定<code>nodemonConfig</code>相关配置，将<code>start</code>命令替换为<code>nodemon -x babel-node src/index.js</code>。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;nodemonConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dev&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;execMap&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --harmony&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;ext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js json&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;ignore&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;dist/&quot;</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;src/&quot;</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改<code>src/index.js</code>内容，<code>nodemon</code>就能快速响应改动并重启命令。<code>nodemon配置</code>可查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Fnodemon.io" target="_blank" rel="noopener noreferrer">Nodemon官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，在此不深入讲述了。</p> <h2 id="代码规范"><a href="#代码规范" class="header-anchor">#</a> 代码规范</h2> <blockquote><p>技术要点：Stylelint、Eslint</p></blockquote> <h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p><code>代码规范</code>是<code>前端工程化</code>落地的基石，在其中扮演着监督者的角色，它主要用于约束团队成员的<code>编码规范</code>与<code>编码风格</code>。应用代码规范有三点好处。</p> <ul><li>强制规范团队编码规范可让新旧成员编码习惯一样</li> <li>增加项目代码的可维护性与可接入性，新成员能快速适应项目的架构与需求</li> <li>保障项目整体质量，可减少无用代码、重复代码、错误代码和漏洞代码的产生几率</li></ul> <p>这一切的实现都离不开代码校验工具中代码格式化的功能。众所周知，基本所有编辑器都会配置代码校验工具(以下简称<code>Lint</code>)检测代码中的错误或漏洞，根据提供的修复方案格式化出正确代码，让代码更严谨。本章将带领你<strong>部署VSCode的代码格式化</strong>，实现保存代码时一键校验，统一所有项目的<code>编码规范</code>与<code>编码风格</code>，养成规范的码字习惯，减少不必要的错误与隐患。</p> <h3 id="背景-一次部署全局运行"><a href="#背景-一次部署全局运行" class="header-anchor">#</a> 背景：一次部署全局运行</h3> <p><code>Lint</code>其实就是编辑器中运行的一个脚本进程，将代码解析为<code>抽象语法树</code>，遍历<code>抽象语法树</code>并通过预设规则做一些判断与改动，再将新的<code>抽象语法树</code>转换为正确代码。整个校验过程都跟<code>抽象语法树</code>相关，若暂未接触过<code>抽象语法树</code>可阅读<code>babel源码</code>或<code>eslint源码</code>了解其工作原理。</p> <p>如何配置<code>Lint</code>，百度谷歌一搜一大堆，在此不深入讲述了。在保存文件时触发<code>Lint</code>自动格式化代码，该操作当然不能<code>100%</code>保证将代码格式化出最正确的代码，而是尽可能根据修复方案格式化出正确的代码。简而言之，可能存在部分代码格式化失败，但将鼠标移至红色下划线上会提示修复方案，可根据修复方案自行修正代码。</p> <p>我很喜欢严谨的代码逻辑与优雅的编码风格，所以也很喜欢格式化代码，但我不想为每个项目配置<code>Lint</code>。这些重复无脑的复制粘贴让我很反感，所以更多时候我只想对<code>Lint</code>做到<strong>一次部署全局运行</strong>。</p> <p><code>代码规范</code>很适合使用<code>一次部署全局运行</code>这样的方式处理。若使用该方案，相信能将所有项目的<code>stylelint/eslint/tslint/prettier</code>相关依赖与配置文件全部删除，使项目结构变得超级简洁。</p> <img src="https://picmagic.oss-cn-beijing.aliyuncs.com/img/image-20220614170343857.png" alt="image-20220614170343857" style="zoom:67%;"> <p>在部署<code>代码规范</code>前，我想要强调以下情况。</p> <ul><li><code>Tslint官方</code>已宣布废弃<code>tslint</code>，改用<code>eslint</code>代替其所有校验功能</li> <li><code>eslint</code>部分配置与<code>prettier</code>部分配置存在冲突且互相影响，为了保障格式化性能就放弃接入<code>prettier</code></li></ul> <p>所以<code>VSCode</code>只需安装<code>Stylelint</code>与<code>Eslint</code>两个插件。为了方便理解，统一以下名词。</p> <ul><li>以下提及的<code>Stylelint</code>与<code>Eslint</code>都为<code>VSCode插件</code></li> <li>以下提及的<code>stylelint</code>与<code>eslint</code>都为<code>Npm模块</code></li></ul> <h3 id="方案-部署vscode的代码格式化"><a href="#方案-部署vscode的代码格式化" class="header-anchor">#</a> 方案：部署VSCode的代码格式化</h3> <p>整体配置相比单独为项目接入<code>stylelint</code>与<code>eslint</code>更简单。</p> <h4 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h4> <p>为了搞清两个插件集成哪些依赖，以下区分安装<code>stylelint</code>与<code>eslint</code>及其相关依赖。不过，先别急着安装，后面我有更简单的解决方案。我有个习惯：<code>喜欢将依赖更新到最新版本，在享受新功能的同时也顺便填坑</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># stylelint及其依赖</span>
<span class="token function">npm</span> i stylelint stylelint-config-standard stylelint-order postcss-html postcss-scss postcss-less
<span class="token comment"># eslint及其依赖</span>
<span class="token function">npm</span> i @babel/core @babel/eslint-parser @babel/preset-react eslint eslint-config-standard eslint-plugin-html eslint-plugin-import eslint-plugin-n eslint-plugin-promise eslint-plugin-react eslint-plugin-react-hooks eslint-plugin-vue vue-eslint-parser
<span class="token comment"># typescript-eslint及其依赖</span>
<span class="token function">npm</span> i -D @typescript-eslint/eslint-plugin @typescript-eslint/parser typescript eslint-config-standard-with-typescript
</code></pre></div><p>安装完毕需配置多份文件，<strong>CSS类型</strong>有<code>html/css/scss/less/vue文件</code>，<strong>JS类型</strong>有<code>html/js/ts/jsx/tsx/vue文件</code>。查看插件文档，<code>Stylelint</code>的配置文件可同时校验<code>html/css/scss/less/vue文件</code>，<code>Eslint</code>需配置不同文件分别校验<code>html/js/ts/jsx/tsx/vue文件</code>。两个插件可在<code>settings.json</code>中通过指定字段覆盖默认配置。</p> <blockquote><p>settings.json是VSCode的配置文件，用户可通过插件暴露的字段自定义编辑器功能。</p></blockquote> <p>因为配置文件太多不好管理，我将这些配置文件整合起来，封装为<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Ftree%2Fmain%2Fpackages%2Fstd" target="_blank" rel="noopener noreferrer">@yangzw/bruce-std<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这样就能跳过上述的依赖安装，执行以下命令安装<code>@yangzw/bruce-std</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -g @yangzw/bruce-std
</code></pre></div><p><code>@yangzw/bruce-std</code>包括以下文件夹。</p> <p><strong>demo文件夹</strong></p> <ul><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Ftree%2Fmain%2Fpackages%2Fstd%2Fdemo" target="_blank" rel="noopener noreferrer">demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：随便捣鼓几个示例用于测试格式化代码</li></ul> <p><strong>stylelint文件夹</strong></p> <ul><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Fstylelint%2Fstylelintrc.js" target="_blank" rel="noopener noreferrer">stylelintrc.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：校验<code>html/css/scss/less/vue文件</code></li></ul> <p><strong>eslint文件夹</strong>：校验<code>html/js/jsx/vue文件</code></p> <ul><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Feslint%2Feslintrc.js" target="_blank" rel="noopener noreferrer">eslintrc.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：校验<code>html/js文件</code></li> <li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Feslint%2Feslintrc.react.js" target="_blank" rel="noopener noreferrer">eslintrc.react.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：校验<code>html/jsx文件</code></li> <li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Feslint%2Feslintrc.vue.js" target="_blank" rel="noopener noreferrer">eslintrc.vue.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：校验<code>html/vue文件</code></li></ul> <p><strong>tslint文件夹</strong>：校验<code>html/ts/tsx/vue文件</code>(<code>tslint</code>已弃用，使用<code>eslint</code>代替)</p> <ul><li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Ftslint%2Ftsconfig.json" target="_blank" rel="noopener noreferrer">tsconfig.json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：配置<code>TypeScript</code></li> <li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Ftslint%2Ftslintrc.js" target="_blank" rel="noopener noreferrer">tslintrc.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：校验<code>html/ts文件</code></li> <li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Ftslint%2Ftslintrc.react.js" target="_blank" rel="noopener noreferrer">tslintrc.react.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：校验<code>html/tsx文件</code></li> <li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Fblob%2Fmain%2Fpackages%2Fstd%2Ftslint%2Ftslintrc.vue.js" target="_blank" rel="noopener noreferrer">tslintrc.vue.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：校验<code>html/vue文件</code></li></ul> <p>配置文件中的<code>rules</code>可根据自身<code>编码规范</code>与<code>编码风格</code>适当调整，在此不深入讲述了。推荐使用<code>@yangzw/bruce-std</code>默认规则，若校验规则不喜欢可自行调整。</p> <ul><li>配置<code>Stylelint</code>可查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Fstylelint.io%2Fuser-guide%2Frules%2Flist" target="_blank" rel="noopener noreferrer">Stylelint规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>配置<code>Eslint</code>可查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Feslint.org%2Fdocs%2Frules" target="_blank" rel="noopener noreferrer">Eslint规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>配置<code>TypeScriptEslint</code>可查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftypescript-eslint%2Ftypescript-eslint%2Fblob%2Fmaster%2Fpackages%2Feslint-plugin%2FREADME.md" target="_blank" rel="noopener noreferrer">TypeScriptEslint规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>配置<code>VueEslint</code>可查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Feslint.vuejs.org%2Frules" target="_blank" rel="noopener noreferrer">VueEslint规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="配置插件"><a href="#配置插件" class="header-anchor">#</a> 配置插件</h4> <p>到了配置插件这一步，其实操作不复杂，直接把过程罗列出来，跟着我一步一步完成。</p> <ul><li>打开<code>VSCode</code></li> <li>选择左边<code>工具栏</code>的<code>插件</code>，搜索并安装<code>Stylelint</code>与<code>Eslint</code>，安装完毕重启<code>VSCode</code></li> <li>选择<code>文件 → 首选项 → 设置</code>，<code>设置</code>中可选<code>用户</code>或<code>工作区</code> <ul><li><strong>用户</strong>：配置生效后会作用于全局项目(<code>若大部分项目都是单一的React应用或Vue应用推荐使用全局配置</code>)</li> <li><strong>工作区</strong>：配置生效后只会作用于当前打开项目</li></ul></li> <li>点击<code>设置</code>右上角中间图标<code>打开设置(json)</code>，打开的对应文件是<code>settings.json</code></li> <li>加入以下内容并重启<code>VSCode</code>：为了保障每次改动都能正常格式化代码，必须重启<code>VSCode</code></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token comment">// 默认自定义配置</span>
	<span class="token property">&quot;css.validate&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token property">&quot;less.validate&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token property">&quot;scss.validate&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token property">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;source.fixAll.eslint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;source.fixAll.stylelint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 扩展自定义配置</span>
	<span class="token property">&quot;eslint.nodePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;path/@yangzw/bruce-std/node_modules&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;eslint.options&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;overrideConfigFile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;path/@yangzw/bruce-std/eslint/eslintrc.js&quot;</span> <span class="token comment">// 可变❗</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;stylelint.configBasedir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;path/@yangzw/bruce-std&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;stylelint.configFile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;path/@yangzw/bruce-std/stylelint/stylelintrc.js&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;stylelint.customSyntax&quot;</span><span class="token operator">:</span> <span class="token string">&quot;postcss-scss&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可变❗</span>
	<span class="token property">&quot;stylelint.stylelintPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;path/@yangzw/bruce-std/node_modules/stylelint&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;stylelint.validate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;scss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述配置的<code>path</code>为<code>@yangzw/bruce-std</code>模块所在的<strong>Npm根目录</strong>，可执行<code>npm config get prefix</code>获取<strong>Npm根目录</strong>并替换<code>path</code>。</p> <ul><li>执行<code>npm config get prefix</code>获取<strong>Npm根目录</strong>，例如是<code>E:/Node/prefix/node_modules</code></li> <li>将上述配置的<code>path</code>替换为<code>E:/Node/prefix/node_modules</code></li></ul> <p><strong>请保持VSCode及其所有插件都为最新版本</strong>，防止因为版本问题导致<code>Stylelint</code>与<code>Eslint</code>失效。</p> <h4 id="选择配置"><a href="#选择配置" class="header-anchor">#</a> 选择配置</h4> <p>首先配置<code>Stylelint</code>。校验不同类型代码需实时修改<code>stylelint.customSyntax</code>的值。</p> <ul><li><strong>CSS/SCSS</strong>：<code>postcss-scss</code></li> <li><strong>CSS/LESS</strong>：<code>postcss-less</code></li> <li><strong>HTML/VUE</strong>：<code>postcss-html</code></li></ul> <p>其次配置<code>Eslint</code>。校验不同类型代码需实时修改<code>eslint.options.overrideConfigFile</code>的值。</p> <ul><li><strong>JS</strong>：<code>path/@yangzw/bruce-std/eslint/eslintrc.js</code></li> <li><strong>React</strong>：<code>path/@yangzw/bruce-std/eslint/eslintrc.react.js</code></li> <li><strong>Vue</strong>：<code>path/@yangzw/bruce-std/eslint/eslintrc.vue.js</code></li> <li><strong>TS</strong>：<code>path/@yangzw/bruce-std/tslint/tslintrc.js</code></li> <li><strong>React TS</strong>：<code>path/@yangzw/bruce-std/tslint/tslintrc.react.js</code></li> <li><strong>Vue TS</strong>：<code>path/@yangzw/bruce-std/tslint/tslintrc.vue.js</code></li></ul> <p>以上述路径<code>E:/Node/prefix/node_modules</code>为例。在默认情况下，<code>Eslint</code>只能校验<code>普通JS</code>。若校验其他<code>JS类型</code>需将<code>eslint.options.overrideConfigFile</code>的<code>path</code>改为以下路径。</p> <ul><li><strong>React</strong>：<code>E:/Node/prefix/node_modules/@yangzw/bruce-std/eslint/eslintrc.react.js</code></li> <li><strong>Vue</strong>：<code>E:/Node/prefix/node_modules/@yangzw/bruce-std/eslint/eslintrc.vue.js</code></li> <li><strong>TS</strong>：<code>E:/Node/prefix/node_modules/@yangzw/bruce-std/tslint/tslintrc.js</code></li> <li><strong>React TS</strong>：<code>E:/Node/prefix/node_modules/@yangzw/bruce-std/tslint/tslintrc.react.js</code></li> <li><strong>Vue TS</strong>：<code>E:/Node/prefix/node_modules/@yangzw/bruce-std/tslint/tslintrc.vue.js</code></li></ul> <h4 id="示例-一键修复并格式化代码"><a href="#示例-一键修复并格式化代码" class="header-anchor">#</a> 示例：一键修复并格式化代码</h4> <p>上述步骤操作完毕就可愉快地敲代码了。每次保存文件可自动格式化<code>CSS代码</code>与<code>JS代码</code>，该功能不仅将代码根据规范<code>整理</code>与<code>排序</code>，甚至尽可能根据修复方案格式化出正确的代码。</p> <p>这样就无需为每个项目配置<code>Lint</code>，将所有项目的<code>stylelint/eslint/tslint/prettier</code>相关依赖与配置文件全部删除，使项目结构变得超级简洁。值得注意，若项目太复杂或太老旧，就不要折腾了，要保持对旧代码的敬畏之心！</p> <blockquote><p>html/css/scss/less/vue文件</p></blockquote> <p><img src="https://picmagic.oss-cn-beijing.aliyuncs.com/img/a8lu1-fsxka.gif" alt="img"></p> <blockquote><p>html/js/ts/jsx/tsx/vue文件</p></blockquote> <p><img src="https://picmagic.oss-cn-beijing.aliyuncs.com/img/ay1h2-ip5uj.gif" alt="img"></p> <h3 id="答疑-vscode细节问题"><a href="#答疑-vscode细节问题" class="header-anchor">#</a> 答疑：VSCode细节问题</h3> <h4 id="更新eslint到v6-就会失效"><a href="#更新eslint到v6-就会失效" class="header-anchor">#</a> 更新eslint到v6+就会失效</h4> <p>很多同学反映<code>eslint v6+</code>在<code>VSCode</code>中失效，最高使用版本只能控制在<code>v5.16.0</code>。其实这本身就是配置问题，跟版本无关。<code>@yangzw/bruce-std</code>的<code>eslint</code>使用<code>v8</code>，只要配置正确就能正常使用。</p> <p>上述安装行为使用了<code>Npm</code>，那<code>settings.json</code>的<code>eslint.packageManager</code>必须配置为<code>npm</code>(小写)，但最新版本<code>Eslint</code>已默认此项，所以无需配置。若执行<code>yarn global add @yangzw/bruce-std</code>，那必须在<code>settings.json</code>中加入以下内容。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;eslint.packageManager&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="首次安装eslint并执行上述配置就会失效"><a href="#首次安装eslint并执行上述配置就会失效" class="header-anchor">#</a> 首次安装Eslint并执行上述配置就会失效</h4> <p>首次安装<code>Eslint</code>可能会在<code>js/ts/jsx/tsx/vue文件</code>的控制台中看到以下警告。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Eslint is disabled since its execution has not been approved or denied yet. Use the light bulb menu to <span class="token function">open</span> the approval dialog.
</code></pre></div><p>该警告说明<code>Eslint</code>被禁用。虽然配置中无明确的禁用字段，但还是被禁用了。移步到<code>VSCode</code>右下角的工具栏会看到<code>禁用图标+ESLINT</code>的标红按钮，单击它就会弹出一个弹框，选择<code>Allow Everywhere</code>就能启用<code>Eslint</code>的校验功能了。</p> <h4 id="为何不考虑使用prettier"><a href="#为何不考虑使用prettier" class="header-anchor">#</a> 为何不考虑使用Prettier</h4> <p>首先<code>Eslint</code>是保障<code>JS类型代码</code>的质量工具，该工具必须配置。其次<code>Vscode</code>现在可基于<code>Eslint</code>格式化出正确的代码。既然一个编辑器已内置了格式化代码的功能，为何还要额外引入一个<code>Prettier</code>？</p> <p>使用过<code>Eslint</code>与<code>Prettier</code>的同学都知道，两者的标准配置存在冲突状态，那修改<code>Eslint</code>与<code>Prettier</code>哪个配置？反正都得改，改完还得确认。</p> <p>若基于<code>Eslint</code>使用<code>Vscode</code>内置的格式化功能，那只需专注<code>eslint配置</code>，完全没必要花时间维护<code>Eslint</code>与<code>Prettier</code>的冲突配置啊！</p> <p>这些事情仁者见仁智者见智，相信大部分同学使用了本方案会喜欢更纯净的<code>eslint配置</code>，而不是<code>Eslint</code>与<code>Prettier</code>合并还要修改冲突这样的配置。</p> <h2 id="提交规范"><a href="#提交规范" class="header-anchor">#</a> 提交规范</h2> <blockquote><p>技术要点：Commitizen、Commitlint</p></blockquote> <h3 id="前言-2"><a href="#前言-2" class="header-anchor">#</a> 前言</h3> <p>管理项目版本通常会选择使用<code>Git</code>，它可敏捷高效地处理任何项目。毕竟<code>Git</code>是世界上目前最先进的<code>分布式版本控制系统</code>与<code>内容管理系统</code>了。</p> <p>想要用好<code>Git</code>并不容易，因为在使用<code>Git</code>托管代码时，很多同学喜欢命令行编程，这样每次提交都必须书写<code>Commit Message</code>。规范的<code>Message</code>不仅能帮助别人<code>Review</code> ，还能有效地输出<code>Changelog</code>，甚至对项目的<code>Quality</code>都有很大提升。</p> <p>在日常开发中经常遇到一些千奇百怪的提交说明，例如中英文混合使用，各种不规范的英文单词等。这让<code>Review</code>这些提交说明时会经常搞不清它们到底是干哈的，导致后续代码维护成本巨大。</p> <p>要想你的<code>前端工程化</code>项目更易于维护，最好有一套<code>Git</code>提交说明的<code>规范化模板</code>。本章将带领你<strong>部署Git的提交格式化</strong>，通过交互式问答生成提交模板，让<code>提交规范</code>更好地服务代码质量，以提升开发效率。</p> <h3 id="背景-以一次提交说明不规范为例"><a href="#背景-以一次提交说明不规范为例" class="header-anchor">#</a> 背景：以一次提交说明不规范为例</h3> <p>在学习<code>提交规范</code>前先看一个不规范的示例，看完是不是想锤人？没错，不规范的提交说明让人无法快速得知项目有何变化，从这样的提交说明中是无法获取任何有效信息的，这对接手的同学来说无疑是一种致命的打击。</p> <p><img src="https://picmagic.oss-cn-beijing.aliyuncs.com/img/image-20220614205207869.png" alt="image-20220614205207869"></p> <p>那如何避免这种混乱的<code>提交规范</code>？最简单，可直接利用市面上已成熟的<code>提交规范</code>，例如<strong>Angular提交规范</strong>。</p> <p><strong>Angular团队</strong>制定的<code>提交规范</code>是目前市面上公认为最合理、最系统、最流行的<code>提交规范</code>，也是我在经过多年团队<code>代码规范</code>后最推荐的。为何这么说？</p> <p>接着一起欣赏<code>Angular提交规范</code>带来的视觉冲击。你会发现即使一目十行地扫视，也能得到每条提交说明的信息，是不是一目了然？</p> <img src="https://picmagic.oss-cn-beijing.aliyuncs.com/img/image-20220614205318070.png" alt="image-20220614205318070" style="zoom:80%;"> <p>当然很多同学可能对<code>Angular提交规范</code>还不是很熟悉，不了解它的架构，甚至没听说过<code>Angular</code>。这都很正常，毕竟很多小公司只注重编码并不会过多考虑代码质量与提交质量，因此更有必要去推行代码管理相关规范，一起做好前端基础建设。</p> <p>那如何才能书写出这么优雅的提交说明？这就需一步一步熟悉它们是如何组成、组合和部署的了。</p> <h3 id="格式-angular提交规范"><a href="#格式-angular提交规范" class="header-anchor">#</a> 格式：Angular提交规范</h3> <p><code>Angular提交规范</code>的格式很简单，基本尝试一次就能学会。若再有命令行工具的加持，可一直用一直爽！</p> <p><code>Angular提交规范</code>的格式包括<code>Header</code>、<code>Body</code>和<code>Footer</code>三个内容。<code>Header</code>为必填项，<code>Body</code>与<code>Footer</code>为可缺省项，这些内容通过以下结构组成一个完整的提交格式。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;
# 空一行
&lt;body&gt;
# 空一行
&lt;footer&gt;
</code></pre></div><h4 id="header"><a href="#header" class="header-anchor">#</a> Header</h4> <p>该部分仅书写一行，包括三个字段，分别是<code>type</code>、<code>scope</code>和<code>subject</code>。</p> <ul><li><strong>type</strong>：用于说明<code>commit</code>的提交类型，必选</li> <li><strong>scope</strong>：用于说明<code>commit</code>的影响范围，可选</li> <li><strong>subject</strong>：用于说明<code>commit</code>的细节描述，可选</li></ul> <p><code>type</code>用于说明<code>commit</code>的提交类型，包括以下选项，相信这些选项已满足日常<code>95%</code>的应用场景。当然这些选项无需刻意记忆，我会引入命令自动完成这些提交工作。</p> <table><thead><tr><th>类型</th> <th>功能</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>feat</strong></td> <td>功能</td> <td>新增功能，迭代项目需求</td></tr> <tr><td><strong>fix</strong></td> <td>修复</td> <td>修复缺陷，修复上一版本存在问题</td></tr> <tr><td><strong>docs</strong></td> <td>文档</td> <td>更新文档，仅修改文档不修改代码</td></tr> <tr><td><strong>style</strong></td> <td>样式</td> <td>变动格式，不影响代码逻辑</td></tr> <tr><td><strong>refactor</strong></td> <td>重构</td> <td>重构代码，非新增功能也非修复缺陷</td></tr> <tr><td><strong>perf</strong></td> <td>性能</td> <td>优化性能，提高代码执行性能</td></tr> <tr><td><strong>test</strong></td> <td>测试</td> <td>新增测试，追加测试用例验证代码</td></tr> <tr><td><strong>build</strong></td> <td>构建</td> <td>更新构建，改动构建工具或外部依赖</td></tr> <tr><td><strong>ci</strong></td> <td>脚本</td> <td>更新脚本，改动CI或执行脚本配置</td></tr> <tr><td><strong>chore</strong></td> <td>事务</td> <td>变动事务，改动其他不影响代码的事务</td></tr> <tr><td><strong>revert</strong></td> <td>回滚</td> <td>回滚版本，撤销某次代码提交</td></tr> <tr><td><strong>merge</strong></td> <td>合并</td> <td>合并分支，合并分支代码到其他分支</td></tr> <tr><td><strong>sync</strong></td> <td>同步</td> <td>同步分支，同步分支代码到其他分支</td></tr> <tr><td><strong>impr</strong></td> <td>改进</td> <td>改进功能，升级当前功能模块</td></tr></tbody></table> <p><code>scope</code>用于说明<code>commit</code>的影响范围。简要说明本次改动的影响范围，例如根据功能可划分为<code>数据层</code>、<code>视图层</code>和<code>控制层</code>，根据交互可划分为<code>组件</code>、<code>布局</code>、<code>流程</code>、<code>视图</code>和<code>页面</code>。从<code>Angular</code>以往的提交说明来看，还是建议你在提交时对<code>scope</code>补全。</p> <p><code>subject</code>用于说明<code>commit</code>的细节描述。文字一定要精简精炼，无需太多备注，因为<code>Body</code>部分可备注更多细节，同时尽量遵循以下规则。</p> <ul><li>以动词开头</li> <li>使用第一人称现在时</li> <li>首个字母不能大写</li> <li>结尾不能存在句号(<code>.</code>)</li></ul> <p>例如本次提交说明的<code>subject</code>的中文是<code>改变按钮的颜色</code>，根据上述规则转换为英文就是<code>change the color of the button</code>。</p> <p>理解好<code>Header</code>三个字段各自含义，每次提交说明通过上述规范的约束就变成以下模样。</p> <div class="language-git extra-class"><pre class="language-git"><code>feat(View): 新增主题皮肤切换按钮
feat(View): new the button for theme skin switching
</code></pre></div><h4 id="body"><a href="#body" class="header-anchor">#</a> Body</h4> <p>该部分可书写多行，对<code>subject</code>做更详尽的描述，内容应包括<code>改动动机</code>与<code>改动前后对比</code>。</p> <h4 id="footer"><a href="#footer" class="header-anchor">#</a> Footer</h4> <p>该部分只适用两种情况，分别是<code>不兼容变动</code>与<code>问题关闭</code>。</p> <ul><li><strong>不兼容变动</strong>：当前代码与上一版本不兼容，则以<code>BREAKING CHANGE</code>开头，关联<code>变动描述</code>、<code>变动理由</code>和<code>迁移方法</code></li> <li><strong>问题关闭</strong>：当前代码已修复某些<code>Issue</code>，则以<code>Closes</code>开头，关联目标<code>Issue</code></li></ul> <h3 id="方案-部署git的提交格式化"><a href="#方案-部署git的提交格式化" class="header-anchor">#</a> 方案：部署Git的提交格式化</h3> <p>理解<code>Angular提交规范</code>的格式后，就能在每次提交时书写标准的提交说明了，同时使用专业工具做专业事情，能输出更高质量的提交说明。接着介绍两个专业工具该如何配置与部署。</p> <h4 id="commitizen"><a href="#commitizen" class="header-anchor">#</a> commitizen</h4> <p>每次执行<code>git commit</code>命令时，需根据上述规范整理提交说明的格式，但提交说明本身并不是项目开发的必须项， 所以可巧借工具完成<code>提交规范</code>。</p> <p>因为当前目标还要通过工具生成与约束提交说明，而<code>commitizen</code>是一个基于模板驱动的约束规范工具，可扩展性很强，因此推荐使用<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fcommitizen%2Fcz-cli" target="_blank" rel="noopener noreferrer">commitizen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>使用<code>commitizen</code>的<code>git cz</code>命令可代替原生的<code>git commit</code>命令，帮助开发者生成符合规范的提交说明。在此还需指定一个符合<code>Angular提交规范</code>的书写配置<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fcommitizen%2Fcz-conventional-changelog" target="_blank" rel="noopener noreferrer">cz-conventional-changelog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，使得<code>commitizen</code>根据指定规范帮助开发者生成提交说明。</p> <p><code>commitizen</code>与<code>cz-conventional-changelog</code>可全局部署也可局部部署，如何选择只能根据实际情况了。</p> <blockquote><p>全局部署</p></blockquote> <p>全局安装<code>commitizen</code>与<code>cz-conventional-changelog</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -g commitizen cz-conventional-changelog
</code></pre></div><p>不同系统中创建<code>.czrc</code>文件，具体情况如下，加入以下内容。</p> <ul><li><code>Windows系统</code>：在<code>C:/Users/$USER</code>目录中创建<code>.czrc</code>文件</li> <li><code>MacOS系统</code>：在<code>~</code>目录中创建<code>.czrc</code>文件</li></ul> <div class="language-txt extra-class"><pre class="language-txt"><code>{ &quot;path&quot;: &quot;cz-conventional-changelog&quot; }
</code></pre></div><p>点击查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Ffe-engineering%2Fblob%2Fmain%2Fcommit-lint%2Fconfig%2Fczrc.json" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <blockquote><p>局部部署</p></blockquote> <p>局部安装<code>commitizen</code>与<code>cz-conventional-changelog</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -D commitizen cz-conventional-changelog
</code></pre></div><p>在<code>package.json</code>中指定<code>scripts</code>与<code>config</code>。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git-cz&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/cz-conventional-changelog&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>点击查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Ffe-engineering%2Fblob%2Fmain%2Fcommit-lint%2Fconfig%2Fpackage.json" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <hr> <p>使用上述两种方式配置好<code>commitizen</code>，就能使用<code>git cz</code>或<code>npm run commit</code>代替<code>git commit</code>了，依次完成所有步骤就能规范地提交了。</p> <blockquote><p>自定义规范</p></blockquote> <p>也许<code>Angular提交规范</code>的某些情况不适合当前需求，可通过<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fleoforfree%2Fcz-customizable" target="_blank" rel="noopener noreferrer">cz-customizable<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>制定一份符合自己团队的<code>提交规范</code>。</p> <p>基于上述<code>全局部署</code>与<code>局部部署</code>，以下配置也有些许不同。</p> <p>对于<code>全局部署</code>，全局安装<code>cz-customizable</code>，在<code>.czrc</code>中重新指定<code>path</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -g cz-customizable
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cz-customizable&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><p>对于<code>局部部署</code>，局部安装<code>cz-customizable</code>，在<code>package.json</code>中重新指定<code>config</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -D cz-customizable
<span class="token punctuation">{</span>
	<span class="token string">&quot;config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;commitizen&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;node_modules/cz-customizable&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>不同系统中创建<code>.cz-config.js</code>文件，具体情况如下，制定一份符合自己团队的<code>提交规范</code>。为了方便理解，我将原来英文版的<code>commit type</code>改为中文版的<code>commit type</code>并增加几个<code>type</code>。</p> <ul><li>在<code>Windows系统</code>全局部署：在<code>C:/Users/$USER</code>目录中创建<code>.cz-config.js</code>文件</li> <li>在<code>MacOS系统</code>中全局部署：再<code>~</code>目录中创建<code>.cz-config.js</code>文件</li> <li>在项目中局部部署：在根目录中创建<code>.cz-config.js</code>文件</li></ul> <h4 id="commitlint"><a href="#commitlint" class="header-anchor">#</a> commitlint</h4> <p>除了规范地书写提交说明，还需借助<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fconventional-changelog%2Fcommitlint" target="_blank" rel="noopener noreferrer">commitlint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>规范地校验提交说明。<code>commitlint</code>的校验标准较严格，只要不符合规范的提交说明就直接拒绝。</p> <p>同<code>commitizen</code>一样，<code>commitlint</code>也需一套校验配置。当然还是推荐与<code>Angular提交规范</code>相关校验配置<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fconventional-changelog%2Fcommitlint" target="_blank" rel="noopener noreferrer">@commitlint/config-conventional<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。然而我暂时还未能实践出<code>commitlint</code>的全局部署，所以目前只能参照官网实现局部部署了。</p> <p>局部安装<code>@commitlint/cli</code>与<code>@commitlint/config-conventional</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -D @commitlint/cli @commitlint/config-conventional
</code></pre></div><p>在根目录中创建<code>.commitlintrc.js</code>文件，加入以下内容。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;@commitlint/config-conventional&quot;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当然也能像<code>commitizen</code>那样自定义校验规范。也许<code>Commitlint校验规范</code>的某些情况不适合，可通过<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwhizark%2Fcommitlint-config-cz" target="_blank" rel="noopener noreferrer">commitlint-config-cz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>制定一份符合自己团队的<code>校验规范</code>。</p> <p>局部安装<code>commitlint-config-cz</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -D commitlint-config-cz
</code></pre></div><p>在<code>.commitlintrc.js</code>中重新指定<code>extends</code>与<code>rules</code></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;cz&quot;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当然也能像<code>commitizen</code>那样自定义校验规范。也许<code>Commitlint校验规范</code>的某些情况不适合，可通过<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwhizark%2Fcommitlint-config-cz" target="_blank" rel="noopener noreferrer">commitlint-config-cz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>制定一份符合自己团队的<code>校验规范</code>。</p> <p>局部安装<code>commitlint-config-cz</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -D commitlint-config-cz
</code></pre></div><p>在<code>.commitlintrc.js</code>中重新指定<code>extends</code>与<code>rules</code></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;cz&quot;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>从<code>前端工程化</code>的角度来看，<code>提交规范</code>侧面反映着代码质量，良好的<code>提交规范</code>能促进项目的协作与交接，使得项目开发在何时何地都能有效开展。</p> <h2 id="站服务器"><a href="#站服务器" class="header-anchor">#</a> 站服务器</h2> <h3 id="背景-站服务器是什么"><a href="#背景-站服务器是什么" class="header-anchor">#</a> 背景：站服务器是什么</h3> <p><strong>站服务器</strong>又称<code>Web服务器</code>或<code>网站服务器</code>，简称<code>WS</code>，指驻留在因特网中的网络应用程序，用于处理客户端的请求并返回响应，可存放资源文件供全世界浏览，可存放数据文件供全世界下载。</p> <p><code>站服务器</code>主要功能是向客户端提供文档服务，只要是遵循<code>HTTP</code>设计的网络应用程序都可认为是<code>站服务器</code>。其工作原理分为三个过程，分别是连接过程、请求过程和应答过程。</p> <p>熟悉<code>HTTP服务器</code>的同学可能发现<code>站服务器</code>的工作原理与其类似。其实在软件开发与使用过程中，<code>站服务器</code>等同于<code>HTTP服务器</code>。虽然不同<code>站服务器</code>间有细节上的差异，但其基础原理都是一样的。</p> <ul><li><strong>Step1</strong>：用户在地址栏中输入网址并按下回车键</li> <li><strong>Step2</strong>：客户端与服务端建立<code>TCP连接</code></li> <li><strong>Step3</strong>：客户端将用户行为根据<code>HTTP格式</code>打包成数据包</li> <li><strong>Step4</strong>：服务端接收到数据包后，以<code>HTTP格式</code>解析并获取客户端意图</li> <li><strong>Step5</strong>：客户端确认服务端可写，将数据包通过因特网递交到服务端</li> <li><strong>Step6</strong>：服务端获取客户端意图后，将数据包分类处理并返回处理结果</li> <li><strong>Step7</strong>：服务端将处理结果装入缓冲区</li> <li><strong>Step8</strong>：服务端将处理结果根据<code>HTTP格式</code>打包成数据包</li> <li><strong>Step9</strong>：服务端确定客户端可写，将数据包通过因特网递交到客户端</li> <li><strong>Step10</strong>：客户端接收到数据包后，以<code>HTTP格式</code>解析并获取处理结果</li> <li><strong>Step11</strong>：客户端处理相关数据并展示在页面中</li></ul> <p>通过梳理不难发现，这是一个简单的网络通信过程。简而言之，就是一个简单的<code>发送数据</code>、<code>接受数据</code>和<code>处理数据</code>的过程。更高级的<code>站服务器</code>，无非就是将上述三个过程的内容划分得更详细一点而已。若非得对<code>HTTP服务器</code>与<code>站服务器</code>做一个差异化对比，那<code>HTTP服务器</code>是建立在<code>HTTP</code>上用于提供文档浏览的服务器，更多的是提供静态文件的浏览功能，而<code>站服务器</code>则涵盖了<code>HTTP服务器</code>涉及的功能，不仅能存储文档还能在用户通过客户端提供信息的基础上运行其他脚本。</p> <p>常见<code>站服务器</code>有<code>Nginx</code>、<code>Apache</code>和<code>Tomcat</code>。</p> <h3 id="方案-基于nginx反向代理应用与服务"><a href="#方案-基于nginx反向代理应用与服务" class="header-anchor">#</a> 方案：基于Nginx反向代理应用与服务</h3> <p><strong>Nginx</strong>不仅具备反向代理、负载均衡、缓存服务等功能，还支持热部署。它几乎可做到<code>7*24</code>小时不间断运行，即使运行几个月也无需重启，还能在不间断运行的情况下热更新软件版本。<code>Nginx</code>主打高性能，其占用内存少、并发能力强、能支持高达<code>50000</code>个并发连接数，满足日常使用不在话下。</p> <p>对于开发者来说<code>Node</code>并不陌生，<code>Nginx</code>与<code>Node</code>有着很多相似理念，例如<code>HTTP服务器</code>、<code>事件驱动</code>、<code>非阻塞式I/O模型</code>等，而<code>Nginx</code>大部分功能使用<code>Node</code>也可实现，但两者并不冲突。<code>Nginx</code>擅长底层服务器资源的处理，<code>Node</code>擅长顶层具体业务逻辑的处理，两者可完美组合互相助力。</p> <h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <p>打开<code>CMD工具</code>，登录服务器。第5章使用<code>yum</code>安装了<code>Nginx</code>，执行<code>nginx -v</code>，发现其版本不是最新版本。<code>CentOS8</code>自带的<code>Nginx版本</code>是<code>1.14</code>，因此自行创建高版本的<code>Nginx源</code>，在<code>yum install nginx</code>时才会安装最新版本的<code>Nginx</code>。</p> <p>执行<code>vim /etc/yum.repos.d/nginx.repo</code>，加入以下内容。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>nginx-stable<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>nginx stable repo
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://nginx.org/packages/centos/<span class="token variable">$releasever</span>/<span class="token variable">$basearch</span>/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://nginx.org/keys/nginx_signing.key
<span class="token assign-left variable">module_hotfixes</span><span class="token operator">=</span>true

<span class="token punctuation">[</span>nginx-mainline<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>nginx mainline repo
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://nginx.org/packages/mainline/centos/<span class="token variable">$releasever</span>/<span class="token variable">$basearch</span>/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://nginx.org/keys/nginx_signing.key
<span class="token assign-left variable">module_hotfixes</span><span class="token operator">=</span>true
</code></pre></div><p>执行<code>yum info nginx</code>查看最新版本。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>上次元数据过期检查：1:09:43 前，执行于 <span class="token number">2022</span>年05月29日 星期日 04时56分26秒。
已安装的软件包 <span class="token comment"># 当前版本</span>
名称         <span class="token builtin class-name">:</span> nginx
时期         <span class="token builtin class-name">:</span> <span class="token number">1</span>
版本         <span class="token builtin class-name">:</span> <span class="token number">1.14</span>.0
<span class="token punctuation">..</span>.

可安装的软件包 <span class="token comment"># 最新版本</span>
名称         <span class="token builtin class-name">:</span> nginx
时期         <span class="token builtin class-name">:</span> <span class="token number">1</span>
版本         <span class="token builtin class-name">:</span> <span class="token number">1.22</span>.0
<span class="token punctuation">..</span>.
</code></pre></div><p>再执行<code>yum install nginx</code>重新安装<code>Nginx</code>，再执行<code>nginx -v</code>，输出版本与上述信息一致表示更新成功。</p> <p>打开<code>FTP工具</code>，发现大部分<code>Nginx配置文件</code>存放在<code>/ect/nginx</code>目录中。虽然配置文件众多，但只需关注<code>/etc/nginx/conf.d</code>目录，该目录用于存放用户自定义的子配置文件。</p> <p>主配置文件<code>nginx.conf</code>中有一行<code>include /etc/nginx/conf.d/*.conf</code>代码，其作用是当<code>Nginx</code>运行时，主配置文件会默认加载<code>/etc/nginx/conf.d</code>目录中所有子配置文件。</p> <h4 id="操作"><a href="#操作" class="header-anchor">#</a> 操作</h4> <p>启动<code>Nginx</code>后，得益其安全稳定的特性，若未遇到特殊情况几乎都不会再重启，只需掌握以下几条命令就能操作<code>nginx</code>。</p> <table><thead><tr><th>命令</th> <th>功能</th></tr></thead> <tbody><tr><td><code>nginx</code></td> <td>启动进程</td></tr> <tr><td><code>nginx -t</code></td> <td>验证配置</td></tr> <tr><td><code>nginx -s reload</code></td> <td>重启进程</td></tr> <tr><td><code>nginx -s stop</code></td> <td>杀掉进程</td></tr> <tr><td><code>ps -ef | grep nginx</code></td> <td></td></tr></tbody></table> <h4 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h4> <p><code>Nginx</code>主配置文件是<code>/etc/nginx/nginx.conf</code>，可用<code>vim /etc/nginx/nginx.conf</code>查看配置。以下是<code>nginx.conf</code>的主体结构。</p> <div class="language-txt extra-class"><pre class="language-txt"><code>nginx.conf # 全局配置
├── events # 配置影响：Nginx服务器与用户的网络连接
├── http   # 配置功能：代理、缓存、日志等功能
│   ├── upstream # 配置后端地址：负载均衡不可或缺的部分
│   ├── server   # 配置虚拟主机：一个http块可包括多个server块
│   ├── server
│   │   ├── location # 一个server块可包括多个location块
│   │   ├── location # location块指令用于匹配URI
│   │   └── ...
│   └── ...
└── ...
</code></pre></div><ul><li>配置文件由<code>指令</code>与<code>指令块</code>组成</li> <li>指令以<code>分号</code>结尾，指令与参数以<code>空格</code>分隔</li> <li>指令块以<code>大括号</code>将多条指令组织在一起</li> <li>使用<code>$</code>表示变量，提高复用性</li> <li>使用<code>#</code>加入注释，提高可读性</li> <li>部分指令的参数支持正则表达式</li> <li><code>include</code>语句允许组合多个配置文件以提升配置的可维护性</li></ul> <p><code>Nginx变量</code>众多，可查看<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fd082c216d08e" target="_blank" rel="noopener noreferrer">Nginx预定义变量<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，在此不深入讲述了。</p> <h4 id="防火墙"><a href="#防火墙" class="header-anchor">#</a> 防火墙</h4> <p>启动<code>Nginx</code>后，若<code>CentOS</code>开启防火墙，还需在防火墙中加入需开放的端口让网站正常访问。<code>CentOS</code>默认安装了<code>firewalld</code>，可操作<code>firewalld</code>控制指定端口是否开放。</p> <p><code>firewalld</code>的基本使用可通过<code>systemctl</code>管理。<code>systemctl</code>是<code>CentOS</code>服务管理工具中的主要工具，其融合<code>service</code>与<code>chkconfig</code>的功能于一体，只需掌握以下几条命令就能操作<code>firewalld</code>。</p> <table><thead><tr><th>命令</th> <th>功能</th></tr></thead> <tbody><tr><td><code>systemctl start firewalld</code></td> <td>开启防火墙</td></tr> <tr><td><code>systemctl stop firewalld</code></td> <td>关闭防火墙</td></tr> <tr><td><code>systemctl status firewalld</code></td> <td>查看防火墙状态</td></tr> <tr><td><code>systemctl disable firewalld</code></td> <td>开机禁用防火墙</td></tr> <tr><td><code>systemctl enable firewalld</code></td> <td>开机启用防火墙</td></tr></tbody></table> <p>那如何开放一个指定端口？跟着我的步伐，通过执行以下命令就可开放或关闭一个指定端口，以<code>9999</code>端口为例。</p> <ul><li>查看防火墙版本，确保防火墙已安装：<code>firewall-cmd --version</code></li> <li>查看防火墙状态，确保防火墙已开启：<code>firewall-cmd --state</code></li> <li>查看所有打开的端口，若端口已开放则无需继续执行命令：<code>firewall-cmd --zone=public --list-ports</code></li> <li>开放指定端口：<code>firewall-cmd --zone=public --add-port=9999/tcp --permanent</code></li> <li>重载防火墙配置：<code>firewall-cmd --reload</code></li> <li>查看指定端口是否已开放：<code>firewall-cmd --zone=public --query-port=9999/tcp</code></li> <li>删除指定端口：<code>firewall-cmd --zone=public --remove-port=9999/tcp --permanent</code></li></ul> <p>开放指定端口时追加<code>--permanent</code>表示开放端口永久生效，无该参数则重启防火墙会失效。在默认情况下，<code>CentOS</code>的防火墙是关闭的，因此无需主动开放指定端口。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/handbook/browser.html" class="prev">
            🪴浏览器
          </a></span> <span class="next"><a href="/handbook/react.html">
            🌿React
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/handbook/engineering.html#开篇" class="sidebar-link reco-side-开篇" data-v-cb1513f6>开篇</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#背景-前端工程化的兴起" class="sidebar-link reco-side-背景-前端工程化的兴起" data-v-cb1513f6>背景：前端工程化的兴起</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#模块规范" class="sidebar-link reco-side-模块规范" data-v-cb1513f6>模块规范</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#方案-部署node的esm开发环境" class="sidebar-link reco-side-方案-部署node的esm开发环境" data-v-cb1513f6>方案：部署Node的ESM开发环境</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/engineering.html#代码规范" class="sidebar-link reco-side-代码规范" data-v-cb1513f6>代码规范</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#前言" class="sidebar-link reco-side-前言" data-v-cb1513f6>前言</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#背景-一次部署全局运行" class="sidebar-link reco-side-背景-一次部署全局运行" data-v-cb1513f6>背景：一次部署全局运行</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#方案-部署vscode的代码格式化" class="sidebar-link reco-side-方案-部署vscode的代码格式化" data-v-cb1513f6>方案：部署VSCode的代码格式化</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#答疑-vscode细节问题" class="sidebar-link reco-side-答疑-vscode细节问题" data-v-cb1513f6>答疑：VSCode细节问题</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/engineering.html#提交规范" class="sidebar-link reco-side-提交规范" data-v-cb1513f6>提交规范</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#前言-2" class="sidebar-link reco-side-前言-2" data-v-cb1513f6>前言</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#背景-以一次提交说明不规范为例" class="sidebar-link reco-side-背景-以一次提交说明不规范为例" data-v-cb1513f6>背景：以一次提交说明不规范为例</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#格式-angular提交规范" class="sidebar-link reco-side-格式-angular提交规范" data-v-cb1513f6>格式：Angular提交规范</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#方案-部署git的提交格式化" class="sidebar-link reco-side-方案-部署git的提交格式化" data-v-cb1513f6>方案：部署Git的提交格式化</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#总结" class="sidebar-link reco-side-总结" data-v-cb1513f6>总结</a></li><li class="level-2" data-v-cb1513f6><a href="/handbook/engineering.html#站服务器" class="sidebar-link reco-side-站服务器" data-v-cb1513f6>站服务器</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#背景-站服务器是什么" class="sidebar-link reco-side-背景-站服务器是什么" data-v-cb1513f6>背景：站服务器是什么</a></li><li class="level-3" data-v-cb1513f6><a href="/handbook/engineering.html#方案-基于nginx反向代理应用与服务" class="sidebar-link reco-side-方案-基于nginx反向代理应用与服务" data-v-cb1513f6>方案：基于Nginx反向代理应用与服务</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.ec3c4e52.js" defer></script><script src="/assets/js/3.a4c2a10e.js" defer></script><script src="/assets/js/1.f00e5e10.js" defer></script><script src="/assets/js/27.7719ab24.js" defer></script>
  </body>
</html>
